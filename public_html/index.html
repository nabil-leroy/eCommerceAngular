<!DOCTYPE html>
<html>
    <head>
        <title>Vente chiens</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- CSS -->
        <link href="assets/css/foundation.min.css" rel="stylesheet" type="text/css"/>
        <link href="bower_components/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
        <link href="assets/css/style.css" rel="stylesheet" type="text/css"/>
    </head>
    <body ng-app="ecommerceApp">
        <div data-sticky-container>
            <div class="title-bar" data-sticky data-options="marginTop:0;" style="width:100%">
                <div class="title-bar" data-responsive-toggle="example-menu" data-hide-for="medium">
                    <button class="menu-icon" type="button" data-toggle="example-menu"></button>
                    <div class="title-bar-title">Menu</div>
                </div>
                <div class="top-bar" id="example-menu">
                    <div class="top-bar-left">
                        <nav data-magellan>
                            <ul class="dropdown menu" data-dropdown-menu>
                                <li class="menu-text">Animalerie du Noyonnais</li>
                                <li><a href="#">Mini</a></li>
                                <li><a href="#">Medium</a></li>
                                <li><a href="#">Maxi</a></li>
                                <li><a href="#">Géant</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="top-bar-right">
                        <ul class="menu button-group">
                            <li><input type="search" placeholder="Rechercher"></li>
                            <li><button class="button"><i class="fa fa-search fa-lg"></i></button></li>
                            <li><button class="button" data-open="cartModal"><i class="fa fa-shopping-cart fa-lg"></i></button></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Orbit -->
        <div class="hide-for-small-only orbit" role="region" aria-label="Favorite Space Pictures" data-orbit>
            <ul class="orbit-container">
                <button class="orbit-previous"><span class="show-for-sr">Information précédente</span>&#9664;&#xFE0E;</button>
                <button class="orbit-next"><span class="show-for-sr">Information suivante</span>&#9654;&#xFE0E;</button>
                <li class="is-active orbit-slide">
                    <img class="orbit-image" src="assets/img/slide/husky.jpg" alt="Husky">
                <figcaption class="orbit-caption">Des chiots Husky sont disponibles.</figcaption>
                </li>
                <li class="orbit-slide">
                    <img class="orbit-image" src="assets/img/slide/staff.jpeg" alt="Staff">
                <figcaption class="orbit-caption">Ainsi que des staffs!</figcaption>
                </li>
                <li class="orbit-slide">
                    <img class="orbit-image" src="assets/img/slide/s1.jpg" alt="Petit">
                <figcaption class="orbit-caption">Nos chiots de petites tailles a prix réduits</figcaption>
                </li>
                <li class="orbit-slide">
                    <img class="orbit-image" src="assets/img/slide/s2.jpg" alt="Full">
                <figcaption class="orbit-caption">Sur notre site nous avons toutes tailles de chiens</figcaption>
                </li>
            </ul>
            <nav class="orbit-bullets">
                <button class="is-active" data-slide="0"><span class="show-for-sr">First slide details.</span><span class="show-for-sr">Current Slide</span></button>
                <button data-slide="1"><span class="show-for-sr">Second slide details.</span></button>
                <button data-slide="2"><span class="show-for-sr">Third slide details.</span></button>
                <button data-slide="3"><span class="show-for-sr">Fourth slide details.</span></button>
            </nav>
        </div>
        <div ng-controller="topSellCtrl" class="row small-up-2 large-up-4">
            <div class="column" ng-repeat="item in items| filter:{'topSelling':true}">
                <img class="thumbnail" src={{item.picture}} alt={{item.dogName}} title={{item.dogName}}>
                <p>{{item.dogName}}</p>
                <div class="row align-justify">
                    <p class="large-8 column align-self-middle">Mâle : {{item.priceMale| currency:"€"}}</p>
                    <button class="large-2 column align-self-middle button fa fa-cart-arrow-down" ng-click='addCart(item.dogReference, "male")'></button>
                </div>
                <div class="row align-justify">
                    <p class="large-8 column align-self-middle">Femelle : {{item.priceFemale| currency:"€"}}</p>
                    <button class="large-2 column align-self-middle button fa fa-cart-arrow-down" ng-click='addCart(item.dogReference, "female")'></button>
                </div>
            </div>
        </div>
        <hr>
        <div ng-controller='CartCtrl' class="large reveal" id="cartModal" data-reveal>
            <div class="row">
                <div class="medium-2 column">Ref.</div>
                <div class="medium-2 column">Race</div>
                <div class="medium-2 column">Quantité</div>
                <div class="medium-2 column">Prix/U</div>
                <div class="medium-2 column">Prix</div>
                <div class="medium-2 column">Supprimer</div>
            </div>
            <div ng-repeat='item in cartDogs' class="row">
                <div class="medium-2 column" ng-bind="item.dogReference"></div>
                <div class="medium-2 column" ng-bind="item.dogName + ' ' + item.gender"></div>
                <div class="medium-2 column">
                    <div class="medium-3 column">
                        <button ng-click="" class="button alert fa fa-minus" ></button>
                    </div>
                    <div class="medium-6 column">
                        <input type="text" ng-model='item.quantity'>
                    </div>
                    <div class="medium-3 column">
                        <button ng-click="" class="button success fa fa-plus" ></button>
                    </div>
                </div>
                <div class="medium-2 column" ng-bind="item.price | currency: '€'"></div>
                <div class="medium-2 column" ng-bind="item.price * item.quantity | currency: '€'"></div>
                <div class="medium-2 column"><button ng-click="remove($index)" class="button alert fa fa-trash-o fa-lg" ></button></div>
            </div>
            <span>Total : <strong ng-bind="getTotal() | currency: '€'"></strong></span>
            <div><button class="close-button" data-close aria-label="Close modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
        <footer class="footer">
            <div class="row full-width">
                <div class="small-12 medium-3 large-4 columns">
                    <i class="fa fa-info"></i>
                    <p> L'attestation de vente précise : les coordonnées de l'acheteur, les coordonnées du vendeur, le numéro de tatouage du chien, sa date de naissance, son sexe, sa race ou son type de croisement pour un bâtard, le prix de vente, les garanties contre les vices rédhibitoires, la destination du chiot (garde, compagnie, reproduction), les coordonnées du vétérinaire du vendeur, la date de la vente et de la livraison
                    </p>
                </div>
                <div class="small-12 medium-3 large-3 columns">
                    <p><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d41392.749591398155!2d2.972296034172257!3d49.57800521719073!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47e873e777f01ba3%3A0x40af13e816432f0!2s60400+Noyon!5e0!3m2!1sfr!2sfr!4v1491485627128" width="455" height="300" frameborder="0" style="border:0" allowfullscreen></iframe></p>
                </div>
                <div class="small-12 medium-3 large-3 columns">
                    <i class="fa fa-hand-o-down"></i>
                    <ul class="footer-links">
                        <li><a href="#">Mini</a></li>
                        <li><a href="#">Medium</a></li>
                        <li><a href="#">Maxi</a></li>
                        <li><a href="#">Géant</a></li>
                    </ul>
                </div>
            </div>
        </footer>
        <script src="bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
        <script src="bower_components/angularjs/angular.js" type="text/javascript"></script>
        <script src="assets/js/vendor/foundation.min.js" type="text/javascript"></script>
        <script src="assets/js/app.js" type="text/javascript"></script>
        <script>
                var ecommerceApp = angular.module('ecommerceApp', []);
                ecommerceApp.service('productService', function () {
                    var cartItems = [];
                    var addProduct = function (obj, dogReference, gender) {
                        var index = 0;
                        var isFound = false;
                        (obj).forEach(function (element) {
                            if (element.dogReference !== dogReference && !isFound) {
                                index++;
                            } else {
                                isFound = true;
                            }
                        });
                        isFound = false;
                        var cartIndex = 0;
                        cartItems.forEach(function (element) {
                            if (element.dogReference !== dogReference && !isFound) {
                                cartIndex++;
                            } else {
                                isFound = true;
                            }
                        });
                        if (isFound === true) {
                            cartItems[cartIndex].quantity++;
                        } else {
                            if (gender === "male") {
                                var price = obj[index].priceMale;
                            } else {
                                var price = obj[index].priceFemale;
                            }
                            cartItems.push({
                                "dogReference": obj[index].dogReference,
                                "dogName": obj[index].dogName,
                                "quantity": 1,
                                "gender": gender,
                                "price": price
                            });
                        }
                    };
                    var getProducts = function () {
                        return cartItems;
                    };
                    return {
                        addProduct: addProduct,
                        getProducts: getProducts
                    };
                });
                ecommerceApp.controller('topSellCtrl', ['$scope', '$http', 'productService', function ($scope, $ĥttp, productService) {
                        $ĥttp.get('assets/js/items.json').then(function (response) {
                            $scope.items = response.data;
                        });
                        $scope.addCart = function (dogReference, gender) {
                            productService.addProduct($scope.items, dogReference, gender);
                        };
                    }]);
                ecommerceApp.controller('CartCtrl', ['$scope','productService', function ($scope, productService) {
                     $scope.cartDogs = productService.getProducts();
                    }]);
        </script>
    </body>
</html>