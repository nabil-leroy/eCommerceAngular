<!DOCTYPE html>
<html>
    <head>
        <title>Vente chiens</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- CSS -->
        <link href="assets/css/foundation.min.css" rel="stylesheet" type="text/css"/>
        <link href="bower_components/Font-Awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
        <link href="assets/css/style.css" rel="stylesheet" type="text/css"/>
    </head>
    <body ng-app="ecommerceApp">
        <div class="title-bar" data-responsive-toggle="example-menu" data-hide-for="medium">
            <button class="menu-icon" type="button" data-toggle="example-menu"></button>
            <div class="title-bar-title">Menu</div>
        </div>

        <div class="top-bar" id="example-menu">
            <div class="top-bar-left">
                <ul class="dropdown menu" data-dropdown-menu>
                    <li class="menu-text">Site Title</li>
                    <li>
                        <a href="#">One</a>
                        <ul class="menu vertical">
                            <li><a href="#">One</a></li>
                            <li><a href="#">Two</a></li>
                            <li><a href="#">Three</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Two</a></li>
                    <li><a href="#">Three</a></li>
                </ul>
            </div>
            <div class="top-bar-right">
                <ul class="menu">
                    <li><input type="search" placeholder="Search"></li>
                    <li><button type="button" class="button">Search</button></li>
                </ul>
            </div>
        </div>
        <div ng-controller="topSellCtrl" class="row small-up-2 large-up-4">
            <div class="column" ng-repeat="item in items| filter:{'topSelling':true}">
                <img class="thumbnail" src={{item.picture}} alt={{item.dogName}} title={{item.dogName}}>
                <p>{{item.dogName}}</p>
                <div class="row align-justify">
                    <p class="large-8 column align-self-middle">Mâle : {{item.priceMale| currency:"€"}}</p>
                    <button class="large-2 column align-self-middle button fa fa-cart-arrow-down" ng-click='addCart(item.dogReference, "male")'></button>
                </div>
                <div class="row align-justify">
                    <p class="large-8 column align-self-middle">Femelle : {{item.priceFemale| currency:"€"}}</p>
                    <button class="large-2 column align-self-middle button fa fa-cart-arrow-down" ng-click='addCart(item.dogReference, "female")'></button>
                </div>
            </div>
        </div>
        <hr>
        <div ng-controller='CartCtrl' class="large reveal" id="cartModal" data-reveal>
            <div class="row">
                <div class="medium-2 column">Ref.</div>
                <div class="medium-2 column">Race</div>
                <div class="medium-2 column">Quantité</div>
                <div class="medium-2 column">Prix/U</div>
                <div class="medium-2 column">Prix</div>
                <div class="medium-2 column">Supprimer</div>
            </div>
            <div ng-repeat='item in items' class="row">
                <div class="medium-2 column" ng-bind="item.ref"></div>
                <div class="medium-2 column" ng-bind="item.title"></div>
                <div class="medium-2 column">
                    <div class="medium-3 column">
                        <button ng-click="" class="button alert fa fa-minus" ></button>
                    </div>
                    <div class="medium-6 column">
                        <input type="text" ng-model='item.quantity'>
                    </div>
                    <div class="medium-3 column">
                        <button ng-click="" class="button success fa fa-plus" ></button>
                    </div>
                </div>
                <div class="medium-2 column" ng-bind="item.price | currency: '€'"></div>
                <div class="medium-2 column" ng-bind="item.price * item.quantity | currency: '€'"></div>
                <div class="medium-2 column"><button ng-click="remove($index)" class="button alert fa fa-trash-o fa-lg" ></button></div>
            </div>
            <span>Total : <strong ng-bind="getTotal() | currency: '€'"></strong></span>
            <div><button class="close-button" data-close aria-label="Close modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
        <p><a data-open="cartModal">Click me for a modal</a></p>
        <script src="bower_components/jquery/dist/jquery.min.js" type="text/javascript"></script>
        <script src="bower_components/angularjs/angular.js" type="text/javascript"></script>
        <script src="assets/js/vendor/foundation.min.js" type="text/javascript"></script>
        <script src="assets/js/app.js" type="text/javascript"></script>
        <script>
                var ecommerceApp = angular.module('ecommerceApp', []);
                ecommerceApp.controller('topSellCtrl', [ '$scope', '$http', function($scope, $ĥttp){
                $scope.cartItems = [];
                $ĥttp.get('assets/js/items.json').then(function (response){
                $scope.items = response.data;
                });
                $scope.addCart = function(dogReference, gender){
                    var index = 0;
                    var isFound = false;
                ($scope.items).forEach(function(element){
                    if(element.dogReference !== dogReference && !isFound)
                    {
                        index++;
                    }
                    else
                    {
                        isFound = true;
                    }
                });
                if (gender === "male")
                {
                var price = $scope.items[index].priceMale;
                }
                else
                {
                var price = $scope.items[index].priceFemale;
                }
                var doesExist = (Object.values($scope.cartItems)).indexOf($scope.items[index].dogReference);
                if (doesExist !== - 1)
                {
                $scope.cartItems[doesExist].quantity++;
                }
                else
                {
                $scope.cartItems.push({
                "dogReference": $scope.items[index].dogReference,
                        "dogName": $scope.items[index].dogName,
                        "quantity": 1,
                        "gender": gender,
                        "price": price
                });
                }
                };
                }]);
                ecommerceApp.controller('CartCtrl', [function(){
                
                }]);
        </script>
    </body>
</html>